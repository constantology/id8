!function(a,b){function c(c){var d=typeof c=="function"&&a.type(c)=="class"?c:f(c);if(!d)throw new Error(b+" factory: No Class found with a name or type of "+c);return d.create.apply(null,Array.coerce(arguments,1))}function d(a){return"^"+b+"."+a}function e(b,d){var e,f,h=d.module,j=b.split("."),l;return delete d.module,b=b.replace(n,""),d.type||(d.type=b.toLowerCase().split(".").join("-")),e=c.Class(d),f=e.constructor[k]?e.constructor:e,l=a.bless(j.slice(0,-1),h),a.def(f,i,a.describe(b,"w"),!0),g(f),l[j.pop()]=e}function f(a){return o[a]||p[a]||o[b+"."+a]||p[m+"-"+a]}function g(a){var c=a[i],d=a.prototype[__type__];if(c in o||d in p)throw new Error(b+".define: there is already a Class called: "+c);return o[c]=p[d]=a}function h(b,c){var d=[],e;typeof c!="object"||(c=c.constructor);if(typeof c=="function"&&a.type(c)=="class")do!(e=Object.value(c,b))||d.push(e);while(c=c[l]);return d}"use strict";var i="__classname__",j="__name__",k="__singleton__",l="__super__",__type__="__type__",m=b.toLowerCase(),n=/[^A-Za-z0-9_\.]/g,o=a.obj(),p=a.obj(),q=h.bind(null,i),r=h.bind(null,"prototype."+__type__);a.defs(c,{__name__:{value:b},__type__:{value:"library"},define:e,getClass:f},"w",!0),!function(){function b(a){var b=q(a),c=n(b);return b.singleton?t(c,b):c}function d(){return v(this)||this.apply(Object.create(this.prototype),arguments)}function e(b){return a.def(b,"create",a.describe(d.bind(b),"r"),!0),a.def(b,__type__,y,!0),b}function g(b){return Object.keys(b).reduce(function(c,d){return a.got(z,d)||(c[d]=b[d],delete b[d]),c},a.obj())}function h(b,c){var d=Object.getOwnPropertyDescriptor(b,c)||(typeof b[c]=="function"?a.describe(b[c],"cw"):A);return d.writable=!0,d}function m(a,b){switch(typeof b){case"function":return a instanceof b;case"string":return(b=f(b))?a instanceof b:!1}return!1}function n(b){function c(){return this instanceof c?v(this.constructor)||k.apply(this,arguments):d.apply(c,arguments)}var f=b.constructor,g=h(b.extend.prototype,"constructor"),k=r(f,g);return c.prototype=s(b),c.prototype.constructor=c,a.def(c,l,g,!0),f[j]!="anonymous"&&a.def(c,i,a.describe(f[j],"w")),e(c.mimic(f))}function q(b){var c=Object.keys(b||a.obj()).reduce(function(a,c){return a[c]=b[c],a},a.obj());typeof c.extend=="string"&&(c.extend=o[c.extend]||p[c.extend]),typeof c.extend!="function"&&(c.extend=Object);if(typeof c.constructor!="function"||c.constructor===Object)c.constructor=c.extend.valueOf();return typeof c.type!="string"&&c.constructor!==Object&&c.constructor.__name__!="anonymous"&&(c.type=String(c.constructor.__name__).toLowerCase()),c}function r(b,c,d){return c=typeof c!="object"||b.valueOf()===c.value.valueOf()?A:c||A,function(){var e=arguments,f=h(this,"parent"),g,i;return a.def(this,"parent",c||A,!0),g=b.apply(this,a.tostr(e[0])==="[object Arguments]"?e[0]:e),a.def(this,"parent",f,!0),this.chain!==!1&&g===i?this:g}.mimic(b,d)}function s(b){var c=g(b),d=b.extend,e=a.obj(),f=Object.create(d.prototype);return Object.keys(c).forEach(function(b){var d=c[b];switch(a.nativeType(d)){case"object":break;case"function":d=a.describe(r(d,h(f,b),b),"cw");break;default:d=a.describe(d,"ew")}e[b]=!0,a.def(f,b,d,!0)}),Object.getOwnPropertyNames(f).forEach(function(b){if(b in e||typeof f[b]!="function")return;a.def(f,b,a.describe(r(f[b],A),"cw"),!0)}),a.def(f,__type__,a.describe(b.type,"w"),!0),a.def(f,"parent",A,!0),f}function t(b,c){var d=c.singleton===!0?new b:b.create.apply(null,[].concat(c.singleton));return a.def(b,k,a.describe({value:d},"r")),d}function u(a,b){return a[i]===b||a.prototype[__type__]===b}function v(a){return a?a[k]||null:null}function w(a,b){return a[b]=!0,a}function x(a){var b=a.constructor,c=b[i]||b[j];return c==="Class_constructor"?"Anonymous":c}var y=a.describe("class","r"),z="constructor extend mixin singleton type".split(" ").reduce(w,a.obj()),A=a.describe(a.noop,"cw");a.defs(c,{Class:b,is:m,type:x},"r")}(),a.x.cache("Function",function(b){a.def(b.prototype,"callback",a.describe(function(a){return(new c.Callback(this,a)).fire.mimic(this)},"w"))}),a.x.cache("Object",function(b){function c(a){delete this[a]}a.defs(b,{key:function(b,c){for(var d in b)if(a.has(b,d)&&b[d]===c)return d;return null},remove:function(a,b){return(Array.isArray(b)?b:Array.coerce(arguments,1)).forEach(c,a),a}},"w")}),a.x(Object,Array,Boolean,Function),a.def(c,a.__name__,a.describe({value:a},"r")),a.ENV!="commonjs"?a.def(a.global,b,a.describe({value:c},"r")):module.exports=c,c.define(d("Callback"),function(){function d(){return h in this?this:(this[h]=setTimeout(e.bind(this),this.buffer),this.exec.apply(this,arguments))}function e(){clearTimeout(this[h]),delete this[h]}function f(a){return a.indexOf("event")+5===a.length}function g(){return this.fire.apply(this,arguments)}var h="bufferId",i="timeoutId";return{constructor:function(c,e){a.copy(this,e||{});var f=a.describe(null,"w"),g=(a.type(this.buffer)=="number"?d:this.exec).bind(this);f.value=c,a.def(this,"fn",f),f.value=this,a.def(g,"cb",f),f.value=g,a.def(this,"fire",f),this.args||(this.args=[]),this.ctx||(this.ctx=this),a.type(this.delay)=="number"||(this.delay=null),a.type(this.times)=="number"&&this.times>0||(this.times=0),this.enable()},chain:!0,module:c,buffer:null,count:0,delay:null,times:0,disable:function(){this.disabled=!0,this.handleEvent=a.noop},enable:function(){this.disabled=!1,this.handleEvent=g},exec:function(){if(this.disabled)return;this.times===0||this.times>++this.count||this.disable();var c=Array.coerce(arguments),d=this,e=d.ctx,g=d.delay,h=a.type(c[0]),j;return h&&(f(h)||h==b+"-observer")?c.splice.apply(c,[1,0].concat(d.args)):c.unshift.apply(c,d.args),g===null?j=d.fn.apply(e,c):d[i]=setTimeout(function(){d.fn.apply(e,c)},g),j},reset:function(){this.count=0,e.call(this.enable())},stop:function(){!(i in this)||clearTimeout(this[i]),delete this[i]}}}()),c.define(d("Hash"),function(){var b="__hashid__",d=[];return{constructor:function(e){a.def(this,b,a.describe(d.push(a.obj())-1,"w")),a.nativeType(e)!="object"||this.set(e)},module:c,keys:{get:function(){return Object.keys(d[this[b]])}},length:{get:function(){return this.keys.length}},values:{get:function(){return Object.values(d[this[b]])}},aggregate:function(a,c,e){var f=this,g=d[this[b]];return e||(e=f),Object.keys(g).reduce(function(a,b,d){return c.call(e,a,g[b],b,f,d)},a)},clear:function(){d[this[b]]=a.obj()},clone:function(){return new c.Hash(this.valueOf())},each:function(a,c){var e=this,f=d[e[b]];c||(c=e),Object.keys(f).forEach(function(b,d){a.call(c,f[b],b,e,d)},e)},get:function(c){return a.has(d[this[b]],c)?d[this[b]][c]:null},has:function(c){return a.has(d[this[b]],c)},key:function(a){return Object.key(d[this[b]],a)},reduce:function(a,c){var e=this,f=d[e[b]];return Object.keys(f).reduce(function(b,c,d){return a.call(e,b,f[c],c,e,d)},c)},remove:function(c){return a.has(d[this[b]],c)?delete d[this[b]][c]:!1},set:function(c,e){switch(a.nativeType(c)){case"object":Object.keys(c).forEach(function(a){this.set(a,c[a])},this);break;default:d[this[b]][c]=e}},stringify:function(){return JSON.stringify(d[this[b]])},toString:function(){return a.tostr(d[this[b]])},valueOf:function(){return a.copy(a.obj(),d[this[b]])}}}()),c.define(d("Observer"),function(){function d(b){b=a.copy(a.obj(),b);var c=b.ctx,d,e,f,g=b.options,h;Object.remove(b,"ctx","options");for(d in b){e=b[d],f=e.options===o?e.options:g,h=e.ctx===o?e.ctx:c;switch(a.nativeType(e)){case"function":this.observe(d,e,c,g);break;case"object":switch(a.nativeType(e.fn)){case"function":case"object":this.observe(d,e.fn,h,f);break;case"array":e.fn.forEach(function(a){this.observe(d,a,h,f)},this)}break;case"array":e.forEach(function(a){this.observe(d,a,c,g)},this)}}return this}function e(b){var c=this.args.concat(b.options.args),d=b.ctx||this.ctx,e=b.fire||b.fn;return!a.nativeType(e)=="function"?!0:(Object.key(this.ctx,b.fn)?c[0]!==this.ctx||c.shift():c[0]!==this.ctx&&c.unshift(this.ctx),e.apply(d,c)!==!1)}function f(a,b,c){return function(){var e=Array.coerce(arguments);return e[0]!==a||e.shift(),e.unshift(c,b),m.apply(b,e)}}function g(a,b){var c=this;return b.fire=function(){c.ignore(a,b.fn,b.ctx);if(b.fired)return;return b.fired=!0,b.fn.apply(b.ctx||c,arguments)}}function h(a,b){var c=-1,d=a.length;while(++c<d)if(l(b,a[c]))return a[c];return null}function i(b,c,d){var e;return d===this||a.nativeType(e=this.match(d))=="array"&&e[0]===this?b.concat(c):b}function j(a,b){return a.listeners.aggregate([],i,b)}function k(a){return function(){return a.handleEvent.apply(a,arguments)}.mimic(a.fire)}function l(a,b){return(a.isCB===!0?b.fn.valueOf()===a.ctx.fire:b.fn===a.fn)&&b.ctx===a.ctx&&b.event===a.event}function m(){return this.broadcast.apply(this,arguments)}function n(a){return a.replace(q,".*")}var o,p=0,q=/\*/g;return{constructor:function(d){this.broadcasting=!1,this.destroyed=!1,this.observer_suspended=!1,this.listeners=c("Hash"),a.nativeType(d)!="object"||this.observe(d),a.nativeType(this.observers)!="object"||this.observe(this.observers),delete this.observers},module:c,broadcast:function(a){if(this.destroyed||this.observer_suspended||!this.listeners.length||!a)return;var b=Array.coerce(arguments,1),c=j(this,a);if(!c.length)return;this.broadcasting=a,c.every(e,{args:b,ctx:this}),this.broadcasting=!1},buffer:function(b,c,d,e,f){a.nativeType(f)=="object"||(f=a.obj()),f.buffer=Number(b),this.observe(c,d,e,f)},delay:function(b,c,d,e,f){a.nativeType(f)=="object"||(f=a.obj()),f.delay=Number(b),this.observe(c,d,e,f)},destroy:function(){return this.destroyed?!0:this.broadcast("before:destroy")===!1?!1:(this.destroyed=!0,this._destroy(),this.broadcast("destroy"),this.observer_suspended=!0,delete this.listeners,!0)},ignore:function(c,d,e){c=n(c.toLowerCase());var f=this.listeners.get(c),g,i;if(!f)return;switch(a.type(d)){case b+"-callback":i={ctx:d,isCB:!0};break;default:i={ctx:e||this,fn:d}}i.event=c,i=h(f,i),i!==null&&(g=f.indexOf(i),g<0||f.splice(g,1))},observe:function(c,e,f,h){var i,j=this.listeners,l,m;if(a.nativeType(c)=="object")return d.call(this,c);switch(l=a.type(e)){case"array":return i=a.obj(),i[c]={fn:e,options:h,ctx:f},d.call(this,i);case"object":case"nullobject":case b+"-callback":"handleEvent"in e&&(a.nativeType(f)!="object"||h!==o||(h=f),f=e,e=k(e));break;case"string":!f||(e=f[e])}c=n(c.toLowerCase()),(m=j.get(c))||j.set(c,m=[]);switch(a.nativeType(h)){case"boolean":h={single:!!h};break;case"number":h={delay:h};break;case"object":h=a.copy(a.obj(),h);break;default:h=a.obj()}Array.isArray(h.args)||(h.args=[]),i={ctx:f||this,event:c,fn:e,id:++p,options:h},i.fire=(h.single?g.call(this,c,i):i.fn).callback({args:h.args,buffer:h.buffer,ctx:i.ctx,delay:h.delay}),m.push(i)},once:function(b,c,d,e){a.nativeType(e)=="object"||(e=a.obj()),e.single=!0,this.observe(b,c,d,e)},purgeObservers:function(a){var b=this.listeners;if(!a){b.clear();return}a=a.toLowerCase(),!b.has(a)||b.set(a,[])},relayEvents:function(a){var b=Array.coerce(arguments,1),c;while(c=b.shift())this.observe(c,f(this,a,c),a)},resumeEvents:function(){!this.observer_suspended||(this.observer_suspended=!1,this.broadcast("observer:resumed"))},suspendEvents:function(){this.observer_suspended||(this.observer_suspended=!0,this.broadcast("observer:suspended"))},_destroy:a.noop}}())}(typeof m8!="undefined"?m8:typeof require!="undefined"?require("m8"):null,"id8")