!function(a){function b(a){delete this[a]}"use strict";var c,d;a.x.cache("Function",function(b){a.def(b.prototype,"callback",a.describe(function(a){return(new d.Callback(this,a)).fire.mimic(this)},"w"))}),a.x.cache("Object",function(c){a.defs(c,{key:function(b,c){for(var d in b)if(a.has(b,d)&&b[d]===c)return d;return null},remove:function(a,c){return(Array.isArray(c)?c:Array.coerce(arguments,1)).forEach(b,a),a}},"w")}),a.x(Object,Array,Boolean,Function),!function(){function b(b,c){!c&&a.nativeType(b)=="object"&&(c=b,b="");var d,j,l,m,n,o=a.obj(),s=c.extend||Object,w=c.module,x=c.mixin||r,y=c.singleton;return a.nativeType(s)!="string"||(s=u[s]||v[s]),m=c.constructor!==Object?c.constructor:s,b&&(l=b.split("."),j=l.pop(),l=a.bless(l,w)),a.def(o,"parent",q,!0),a.def(o,"constructor",a.describe(g(m,s,j,o),"w"),!0),n=i(c.type||b,d=o.constructor),a.def(d,"__type__",a.describe("class","w"),!0),a.def(o,"__type__",a.describe(n,"w"),!0),Object.remove(c,p),d.prototype=e(o,a.copy(c,x)),a.def(d,"create",a.describe(f(h(d,s)),"w"),!0),b=b.replace(t,""),y?(a.def(d,"singleton",a.describe({value:y===!0?new d:d.create.apply(d,[].concat(y))},"w")),k(d,b,n),d=d.singleton):b&&k(d,b,n),!j||!l||a.def(l,j,a.describe({value:d},"w")),d}function e(b,c){return Object.reduce(c,function(b,c,d){switch(a.nativeType(c)){case"object":a.def(b,d,c,!0);break;default:b[d]=c}return b},b),b}function f(a){return function(){return l(a)||a.apply(Object.create(a.prototype),arguments)}}function g(a,b,d,e){var f=n(a,b,d),g=function(){var a=this===c?null:this,b=a?a.constructor:null;return l(b)||f.apply(j(a,g)?a:Object.create(e),arguments)};return g.mimic(a,d)}function h(b,c){if(!("__super"in b.prototype)){var d=b.prototype,e=c.prototype;Object.keys(e).forEach(function(b){if(b in w)return;switch(a.type(e[b])){case"function":d[b]=a.nativeType(d[b])!="function"?n(e[b],a.noop,b):n(d[b],e[b],b);break;default:b in d||a.def(d,b,Object.getOwnPropertyDescriptor(e,b),!0)}}),Object.keys(d).forEach(function(b){a.nativeType(d[b])!="function"||b in e&&d[b].valueOf()===e[b].valueOf()||(d[b]=n(d[b],a.noop,b))}),e=a.describe({value:Object.create(c.prototype)},"w"),a.def(b,"__super",e),a.def(b.prototype,"__super",e)}return b}function i(b,c){return(a.empty(b)?c.__name__:b.replace(t,"").replace(s,"_")).toLowerCase()}function j(a,b){if(a&&b){if(a instanceof b)return!0;if(!(a=a.constructor))return!1;do if(a===b)return!0;while(a.__super&&(a=a.__super.constructor))}return!1}function k(a,b,c){var d,e=b+o;!b||!(b in u)||(d=!0,console.log(e+"Class")),!c||!(c in v)||(d=!0,console.log(e+"Type")),d&&new Error("id8.Class overwrite error."),u[b]=v[c]=a}function l(a){return a?a.singleton||null:null}function m(a){var b=a.constructor,c;for(c in u)if(u[c]===b)return c;return b.__name__!="anonymous"?b.__name__:"Anonymous"}function n(b,d,e){return function(){var e,f=Object.getOwnPropertyDescriptor(this,"parent")||q;return f.writable=!0,a.def(this,"parent",d?a.describe(d,"cw"):q,!0),e=b.apply(this,arguments),a.def(this,"parent",f,!0),this.chain!==!1&&e===c?this:e}.mimic(b,e)}d=function(b){var c=a.type(b)=="class"?b:v[b]||v["id8_"+b]||u[b];return c||new Error(b+" does not match any registered id8.Class."),c.create.apply(null,Array.coerce(arguments,1))};var o=" already exists. Cannot override existing ",p="constructor extend mixin module singleton type".split(" "),q=a.describe(a.noop,"cw"),r=a.obj(),s=/\./g,t=/^\u005E/,u=a.obj(),v=a.obj(),w=a.obj();w.constructor=w.parent=w.__super=w.__type__=!0,a.defs(d,{Class:b,is:j,type:m},"w")}(),a.def(d,"m8",a.describe({value:a},"r")),a.ENV!="commonjs"?a.def(a.global,"id8",a.describe({value:d},"r")):module.exports=d,d.Class("^id8.Callback",function(){function b(){return g in this?this:(this[g]=setTimeout(c.bind(this),this.buffer),this.exec.apply(this,arguments))}function c(){clearTimeout(this[g]),delete this[g]}function e(a){return a.indexOf("event")+5===a.length}function f(){return this.fire.apply(this,arguments)}var g="bufferId",h="timeoutId";return{constructor:function(d,e){a.copy(this,e||{});var f=a.describe(null,"w"),g=(a.type(this.buffer)=="number"?b:this.exec).bind(this);f.value=d,a.def(this,"fn",f),f.value=this,a.def(g,"cb",f),f.value=g,a.def(this,"fire",f),this.args||(this.args=[]),this.ctx||(this.ctx=this),a.type(this.delay)=="number"||(this.delay=null),a.type(this.times)=="number"&&this.times>0||(this.times=0),this.enable()},chain:!0,module:d,buffer:null,count:0,delay:null,times:0,disable:function(){this.disabled=!0,this.handleEvent=a.noop},enable:function(){this.disabled=!1,this.handleEvent=f},exec:function(){if(this.disabled)return;this.times===0||this.times>++this.count||this.disable();var b=Array.coerce(arguments),c=this,d=c.ctx,f=c.delay,g=a.type(b[0]),i;return g&&(e(g)||g=="id8_observer")?b.splice.apply(b,[1,0].concat(c.args)):b.unshift.apply(b,c.args),f===null?i=c.fn.apply(d,b):c[h]=setTimeout(function(){c.fn.apply(d,b)},f),i},reset:function(){this.count=0,c.call(this.enable())},stop:function(){!(h in this)||clearTimeout(this[h]),delete this[h]}}}()),d.Class("^id8.Hash",function(){var b="__hashid__",c=[];return{constructor:function(e){a.def(this,b,a.describe(c.push(a.obj())-1,"w")),a.nativeType(e)!="object"||this.set(e)},module:d,keys:{get:function(){return Object.keys(c[this[b]])}},length:{get:function(){return this.keys.length}},values:{get:function(){return Object.values(c[this[b]])}},aggregate:function(a,d,e){var f=this,g=c[this[b]];return e||(e=f),Object.keys(g).reduce(function(a,b,c){return d.call(e,a,g[b],b,f,c)},a)},clear:function(){c[this[b]]=a.obj()},clone:function(){return new d.Hash(this.valueOf())},each:function(a,d){var e=this,f=c[e[b]];d||(d=e),Object.keys(f).forEach(function(b,c){a.call(d,f[b],b,e,c)},e)},get:function(d){return a.has(c[this[b]],d)?c[this[b]][d]:null},has:function(d){return a.has(c[this[b]],d)},key:function(a){return Object.key(c[this[b]],a)},reduce:function(a,d){var e=this,f=c[e[b]];return Object.keys(f).reduce(function(b,c,d){return a.call(e,b,f[c],c,e,d)},d)},remove:function(d){return a.has(c[this[b]],d)?delete c[this[b]][d]:!1},set:function(d,e){switch(a.nativeType(d)){case"object":Object.keys(d).forEach(function(a){this.set(a,d[a])},this);break;default:c[this[b]][d]=e}},stringify:function(){return JSON.stringify(c[this[b]])},toString:function(){return a.tostr(c[this[b]])},valueOf:function(){return a.copy(a.obj(),c[this[b]])}}}()),d.Class("^id8.Observer",function(){function b(b){b=a.copy(a.obj(),b);var d=b[p],e,f,g,h=b[t],i;Object.remove(b,p,t);for(e in b){f=b[e],g=f[t]===c?f[t]:h,i=f[p]===c?f[p]:d;switch(a.nativeType(f)){case"function":this.observe(e,f,d,h);break;case"object":switch(a.nativeType(f[r])){case"function":case"object":this.observe(e,f[r],i,g);break;case"array":f[r].forEach(function(a){this.observe(e,a,i,g)},this)}break;case"array":f.forEach(function(a){this.observe(e,a,d,h)},this)}}return this}function e(b){var c=this.args.concat(b[t].args),d=b[p]||this[p],e=b.fire||b[r];return!a.nativeType(e)=="function"?!0:(Object.key(this[p],b[r])?c[0]!==this[p]||c.shift():c[0]!==this[p]&&c.unshift(this[p]),e.apply(d,c)!==!1)}function f(a,b,c){return function(){var e=Array.coerce(arguments);return e[0]!==a||e.shift(),e.unshift(c,b),m.apply(b,e)}}function g(a,b){var c=this;return b.fire=function(){c.ignore(a,b[r],b[p]);if(b.fired)return;return b.fired=!0,b[r].apply(b[p]||c,arguments)}}function h(a,b){var c=-1,d=a.length;while(++c<d)if(l(b,a[c]))return a[c];return null}function i(b,c,d){var e;return d===this||a.nativeType(e=this.match(d))=="array"&&e[0]===this?b.concat(c):b}function j(a,b){return a[s].aggregate([],i,b)}function k(a){return function(){return a.handleEvent.apply(a,arguments)}.mimic(a.fire)}function l(a,b){return(a.isCB===!0?b[r].valueOf()===a[p].fire:b[r]===a[r])&&b[p]===a[p]&&b.event===a.event}function m(){return this.broadcast.apply(this,arguments)}function n(a){return a.replace(w,".*")}var o="broadcasting",p="ctx",q="destroyed",r="fn",s="listeners",t="options",u="observer_suspended",v=0,w=/\*/g;return{constructor:function(c){this[o]=!1,this[q]=!1,this[u]=!1,this[s]=d.Hash(),a.nativeType(c)!="object"||this.observe(c),a.nativeType(this.observers)!="object"||this.observe(this.observers),delete this.observers},module:d,broadcast:function(a){if(this[q]||this[u]||!this[s].length||!a)return;var b=Array.coerce(arguments,1),c=j(this,a);if(!c.length)return;this[o]=a,c.every(e,{args:b,ctx:this}),this[o]=!1},buffer:function(b,c,d,e,f){a.nativeType(f)=="object"||(f=a.obj()),f.buffer=Number(b),this.observe(c,d,e,f)},delay:function(b,c,d,e,f){a.nativeType(f)=="object"||(f=a.obj()),f.delay=Number(b),this.observe(c,d,e,f)},destroy:function(){return this[q]?!0:this.broadcast("before:destroy")===!1?!1:(this[q]=!0,this._destroy(),this.broadcast("destroy"),this[u]=!0,delete this[s],!0)},ignore:function(b,c,d){b=n(b.toLowerCase());var e=this[s].get(b),f,g;if(!e)return;switch(a.type(c)){case"id8_callback":g={ctx:c,isCB:!0};break;default:g={ctx:d||this,fn:c}}g.event=b,g=h(e,g),g!==null&&(f=e.indexOf(g),f<0||e.splice(f,1))},observe:function(d,e,f,h){var i,j=this[s],l,m;if(a.nativeType(d)=="object")return b.call(this,d);switch(l=a.type(e)){case"array":return i=a.obj(),i[d]={fn:e,options:h,ctx:f},b.call(this,i);case"object":case"nullobject":case"id8_callback":"handleEvent"in e&&(a.nativeType(f)!="object"||h!==c||(h=f),f=e,e=k(e));break;case"string":!f||(e=f[e])}d=n(d.toLowerCase()),(m=j.get(d))||j.set(d,m=[]);switch(a.nativeType(h)){case"boolean":h={single:!!h};break;case"number":h={delay:h};break;case"object":h=a.copy(a.obj(),h);break;default:h=a.obj()}Array.isArray(h.args)||(h.args=[]),i={ctx:f||this,event:d,fn:e,id:++v,options:h},i.fire=(h.single?g.call(this,d,i):i[r]).callback({args:h.args,buffer:h.buffer,ctx:i[p],delay:h.delay}),m.push(i)},once:function(b,c,d,e){a.nativeType(e)=="object"||(e=a.obj()),e.single=!0,this.observe(b,c,d,e)},purgeObservers:function(a){var b=this[s];if(!a){b.clear();return}a=a.toLowerCase(),!b.has(a)||b.set(a,[])},relayEvents:function(a){var b=Array.coerce(arguments,1),c;while(c=b.shift())this.observe(c,f(this,a,c),a)},resumeEvents:function(){!this[u]||(this[u]=!1,this.broadcast("observer:resumed"))},suspendEvents:function(){this[u]||(this[u]=!0,this.broadcast("observer:suspended"))},_destroy:a.noop}}())}(typeof m8!="undefined"?m8:typeof require!="undefined"?require("m8"):null)