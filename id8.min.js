!function(a,b){function c(c){var d=g(c)&&a.type(c)=="class"?c:e(c);if(!d)throw new Error(b+" factory: No Class found with a name or type of "+c);return d.create.apply(null,Array.coerce(arguments,1))}function d(b,c){return Object.keys(b).reduce(function(d,e){return a.got(c,e)||(d[e]=b[e],delete b[e]),d},a.obj())}function e(a){return w[a]||x[a]||w[b+"."+a]||x[r+"-"+a]}function f(a,b){switch(typeof b){case"function":return a instanceof b;case"string":return(b=e(b))?a instanceof b:!1}return!1}function g(a){return typeof a=="function"}function h(b){return a.nativeType(b)=="object"}function i(a){return typeof a=="string"}function j(a){return"^"+b+"."+a}function k(c){var d=c[n],e=c.prototype[__type__];if(d in t)throw new Error(b+".register: Unable to register Class without "+n+" property.");e||a.def(c.prototype,__type__,e=d.toLowerCase().split(".").join("-"),"r",!0);if(d in w||e in x)throw new Error(b+".register: Unable to register Class. A Class called: "+d+", with type: "+e+" already exists.");return w[d]=x[e]=c}function l(a,b){return a[b]=!0,a}function m(a){var b=a.constructor,c=b[n]||b[o];return c in t?"Anonymous":c}"use strict";var n="__classname__",o="__name__",p="__singleton__",q="__super__",__type__="__type__",r=b.toLowerCase(),s,t=Function.anon_list,u=a.obj(),v=/[^A-Za-z0-9_\.]/g,w=a.obj(),x=a.obj();a.defs(c=a.expose(c,b,a.ENV=="commonjs"?module:a.global),{get:e,is:f,type:m,register:k},"w",!0),a.expose(a,c),t.Class_constructor=!0,t.Class_instance_method=!0,a.x(Object,Array,Boolean,Function),a.def(c,"define",function(){function b(b,g){var i,j,k,l=d(g,f),m;return h(b)&&(g=b,b=g.classname||"",delete g.classname),m=b.replace(v,""),b=b.split("."),l.type||(l.type=m.toLowerCase().split(".").join("-")),j=c.Class(l),k=b.pop(),i=a.bless(b,g.module),e(l.singleton?j.constructor:j,m),i[k]=j}function e(b,c){return!c||a.def(b,n,c,"cw",!0),k(b)}var f="after before mixins module".split(" ").reduce(l,a.obj());return b}(),"w"),a.def(c,"Class",function(){function b(a){var b=x(a=y(a));return a.singleton?B(b,a.singleton):b}function c(){return j(this)||this.apply(Object.create(this.prototype),arguments)}function j(a){return a?a[p]||null:null}function k(b){return a.tostr(b[0])==="[object Arguments]"?b[0]:b}function m(b,c){var d=Object.getOwnPropertyDescriptor(b,c)||(g(b[c])?a.describe(b[c],"cw"):F);return d.writable=!0,d}function r(a,b,c){return c&&b===s?a:b}function u(b,c){return a.def(b,"parent",c,!0),b}function v(b,c){var d;switch(a.nativeType(c)){case"object":d=c;break;case"function":d=a.describe(z(c,m(this,b),b),"cw");break;default:d=a.describe(c,"ew")}return a.def(this,b,d,!0),this.constructor}function w(b){return a.def(b,__type__,E,!0),a.defs(b,{add:v.bind(b.prototype),create:c.bind(b)},"r",!0),b}function x(b){function d(){return f(this,d)?j(this.constructor)||r(this,p.call(this,arguments),!0):c.apply(d,arguments)}var e=b.constructor,g=b.extend,h=b.chain===!1||g.prototype[C]===!1?G:H,i=m(g.prototype,"constructor"),k=e[o],l=d.prototype=A(b),p=z(e,i);return l.constructor=d,l.parent=F.value,a.def(d,q,i,!0).def(l,C,h,!0),a.got(t,k)||a.def(d,n,k,"cw").def(d,"displayName",k,"cw"),w(d.mimic(e))}function y(b){var c=a.merge(a.obj(),b),d=c.constructor,f,h=c.extend;return!i(h)||(h=e(h)),g(h)||(h=Object),g(d)&&d!==Object||(d=h.valueOf()),i(c.type)||d===Object||a.got(t,f=String(d[o]))||(c.type=f.toLowerCase()),c.constructor=d,c.extend=h,c}function z(a,b,c){return b=!h(b)||a.valueOf()===b.value.valueOf()?F:b||F,function(){var d=m(this,"parent");return r(u(this,b),a.apply(this,k(arguments)),u(this,d)[C]!==!1)}.mimic(a,c)}function A(b){var c=d(b,D),e=b.extend,f=a.obj(),h=Object.reduce(c,function(a,b,c){return f[c]=!0,v.call(a,c,b),a},Object.create(e.prototype));return Object.getOwnPropertyNames(h).forEach(function(b){b in f||!g(this[b])||v.call(this,b,a.describe(z(this[b],F),"cw"))},h),a.def(h,__type__,b.type,"w",!0),a.defs(h,{mixins:{value:a.obj()},parent:F},"w",!0),h}function B(b,c){var d=b.create.apply(null,c===!0?[]:[].concat(c));return a.def(b,p,a.describe({value:d},"r")),d}var C="__chain__",D="chain constructor extend singleton type".split(" ").reduce(l,a.obj()),E=a.describe("class","r"),F=a.describe(z(a.noop,a.describe(a.noop,"cw"),"parent"),"cw"),G=a.describe(!1,"w"),H=a.describe(!0,"w");return b}(),"w"),c.define(j("Callback"),function(){function d(){return h in this?this:(this[h]=setTimeout(e.bind(this),this.buffer),this.exec.apply(this,arguments))}function e(){clearTimeout(this[h]),delete this[h]}function f(a){return a.indexOf("event")+5===a.length}function g(){return this.fire.apply(this,arguments)}var h="bufferId",i="timeoutId";return{constructor:function(c,e){a.copy(this,e||{});var f=a.describe(null,"w"),g=(a.type(this.buffer)=="number"?d:this.exec).bind(this);f.value=c,a.def(this,"fn",f),f.value=this,a.def(g,"cb",f),f.value=g,a.def(this,"fire",f),this.args||(this.args=[]),this.ctx||(this.ctx=this),a.type(this.delay)=="number"||(this.delay=null),a.type(this.times)=="number"&&this.times>0||(this.times=0),this.enable()},chain:!0,module:c,buffer:null,count:0,delay:null,times:0,disable:function(){this.disabled=!0,this.handleEvent=a.noop},enable:function(){this.disabled=!1,this.handleEvent=g},exec:function(){if(this.disabled)return;this.times===0||this.times>++this.count||this.disable();var c=Array.coerce(arguments),d=this,e=d.ctx,g=d.delay,h=a.type(c[0]),j;return h&&(f(h)||h==b+"-observer")?c.splice.apply(c,[1,0].concat(d.args)):c.unshift.apply(c,d.args),g===null?j=d.fn.apply(e,c):d[i]=setTimeout(function(){d.fn.apply(e,c)},g),j},reset:function(){this.count=0,e.call(this.enable())},stop:function(){!(i in this)||clearTimeout(this[i]),delete this[i]}}}()),c.define(j("Hash"),function(){var b="__hashid__",d=[];return{constructor:function(e){a.def(this,b,a.describe(d.push(a.obj())-1,"w")),!h(e)||this.set(e)},module:c,keys:{get:function(){return Object.keys(d[this[b]])}},length:{get:function(){return this.keys.length}},values:{get:function(){return Object.values(d[this[b]])}},aggregate:function(a,c,e){var f=this,g=d[this[b]];return e||(e=f),Object.keys(g).reduce(function(a,b,d){return c.call(e,a,g[b],b,f,d)},a)},clear:function(){d[this[b]]=a.obj()},clone:function(){return new c.Hash(this.valueOf())},each:function(a,c){var e=this,f=d[e[b]];c||(c=e),Object.keys(f).forEach(function(b,d){a.call(c,f[b],b,e,d)},e)},get:function(c){return a.has(d[this[b]],c)?d[this[b]][c]:null},has:function(c){return a.has(d[this[b]],c)},key:function(a){return Object.key(d[this[b]],a)},reduce:function(a,c){var e=this,f=d[e[b]];return Object.keys(f).reduce(function(b,c,d){return a.call(e,b,f[c],c,e,d)},c)},remove:function(c){return a.has(d[this[b]],c)?delete d[this[b]][c]:!1},set:function(c,e){switch(a.nativeType(c)){case"object":Object.keys(c).forEach(function(a){this.set(a,c[a])},this);break;default:d[this[b]][c]=e}},stringify:function(){return JSON.stringify(d[this[b]])},toString:function(){return a.tostr(d[this[b]])},valueOf:function(){return a.copy(a.obj(),d[this[b]])}}}()),c.define(j("Observer"),function(){function d(b){b=a.copy(a.obj(),b);var c=b.ctx,d,e,f,g=b.options,h;a.remove(b,"ctx","options");for(d in b){e=b[d],f=e.options===s?e.options:g,h=e.ctx===s?e.ctx:c;switch(a.nativeType(e)){case"function":this.observe(d,e,c,g);break;case"object":switch(a.nativeType(e.fn)){case"function":case"object":this.observe(d,e.fn,h,f);break;case"array":e.fn.forEach(function(a){this.observe(d,a,h,f)},this)}break;case"array":e.forEach(function(a){this.observe(d,a,c,g)},this)}}return this}function e(a){var b=this.args.concat(a.options.args),c=a.ctx||this.ctx,d=a.fire||a.fn;return g(d)?(Object.key(this.ctx,a.fn)?b[0]!==this.ctx||b.shift():b[0]!==this.ctx&&b.unshift(this.ctx),d.apply(c,b)!==!1):!0}function f(a,b,c){return function(){var e=Array.coerce(arguments);return e[0]!==a||e.shift(),e.unshift(c,b),o.apply(b,e)}}function i(a,b){var c=this;return b.fire=function(){c.ignore(a,b.fn,b.ctx);if(b.fired)return;return b.fired=!0,b.fn.apply(b.ctx||c,arguments)}}function j(a,b){var c=-1,d=a.length;while(++c<d)if(n(b,a[c]))return a[c];return null}function k(a,b,c){var d;return c===this||Array.isArray(d=this.match(c))&&d[0]===this?a.concat(b):a}function l(a,b){return a.listeners.aggregate([],k,b)}function m(a){return function(){return a.handleEvent.apply(a,arguments)}.mimic(a.fire)}function n(a,b){return(a.isCB===!0?b.fn.valueOf()===a.ctx.fire:b.fn===a.fn)&&b.ctx===a.ctx&&b.event===a.event}function o(){return this.broadcast.apply(this,arguments)}function p(a){return a.replace(r,".*")}var q=0,r=/\*/g;return{constructor:function(b){this.broadcasting=!1,this.destroyed=!1,this.observer_suspended=!1,this.listeners=c("Hash"),!h(b)||this.observe(b),!h(this.observers)||this.observe(this.observers),delete this.observers},module:c,broadcast:function(a){if(this.destroyed||this.observer_suspended||!this.listeners.length||!a)return;var b=Array.coerce(arguments,1),c=l(this,a);if(!c.length)return;this.broadcasting=a,c.every(e,{args:b,ctx:this}),this.broadcasting=!1},buffer:function(b,c,d,e,f){h(f)||(f=a.obj()),f.buffer=Number(b),this.observe(c,d,e,f)},delay:function(b,c,d,e,f){h(f)||(f=a.obj()),f.delay=Number(b),this.observe(c,d,e,f)},destroy:function(){return this.destroyed?!0:this.broadcast("before:destroy")===!1?!1:(this.destroyed=!0,this._destroy(),this.broadcast("destroy"),this.observer_suspended=!0,delete this.listeners,!0)},ignore:function(c,d,e){c=p(c.toLowerCase());var f=this.listeners.get(c),g,h;if(!f)return;switch(a.type(d)){case b+"-callback":h={ctx:d,isCB:!0};break;default:h={ctx:e||this,fn:d}}h.event=c,h=j(f,h),h!==null&&(g=f.indexOf(h),g<0||f.splice(g,1))},observe:function(c,e,f,g){var j,k=this.listeners,l,n;if(h(c))return d.call(this,c);switch(l=a.type(e)){case"array":return j=a.obj(),j[c]={fn:e,options:g,ctx:f},d.call(this,j);case"object":case"nullobject":case b+"-callback":"handleEvent"in e&&(!h(f)||g!==s||(g=f),f=e,e=m(e));break;case"string":!f||(e=f[e])}c=p(c.toLowerCase()),(n=k.get(c))||k.set(c,n=[]);switch(a.nativeType(g)){case"boolean":g={single:!!g};break;case"number":g={delay:g};break;case"object":g=a.copy(a.obj(),g);break;default:g=a.obj()}Array.isArray(g.args)||(g.args=[]),j={ctx:f||this,event:c,fn:e,id:++q,options:g},j.fire=(g.single?i.call(this,c,j):j.fn).callback({args:g.args,buffer:g.buffer,ctx:j.ctx,delay:g.delay}),n.push(j)},once:function(b,c,d,e){h(e)||(e=a.obj()),e.single=!0,this.observe(b,c,d,e)},purgeObservers:function(a){var b=this.listeners;if(!a){b.clear();return}a=a.toLowerCase(),!b.has(a)||b.set(a,[])},relayEvents:function(a){var b=Array.coerce(arguments,1),c;while(c=b.shift())this.observe(c,f(this,a,c),a)},resumeEvents:function(){!this.observer_suspended||(this.observer_suspended=!1,this.broadcast("observer:resumed"))},suspendEvents:function(){this.observer_suspended||(this.observer_suspended=!0,this.broadcast("observer:suspended"))},_destroy:a.noop}}()),a.x.cache("Function",function(b){a.def(b.prototype,"callback",function(a){return(new c.Callback(this,a)).fire.mimic(this)},"w")})}(typeof m8!="undefined"?m8:typeof require!="undefined"?require("m8"):null,"id8")