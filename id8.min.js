!function(e,t){"use strict";function n(n){var r=o(n)&&e.type(n)=="class"?n:i(n);if(!r)throw new Error(t+" factory: No Class found with a name or type of "+n);return r.create.apply(null,Array.coerce(arguments,1))}function r(t,n){return Object.keys(t).reduce(function(r,i){return e.got(n,i)||(r[i]=t[i],delete t[i]),r},e.obj())}function i(e){return S[e]||x[e]||S[t+"."+e]||x[g+"-"+e]}function s(e,t){switch(typeof t){case"function":return e instanceof t;case"string":return(t=i(t))?e instanceof t:!1}return!1}function o(e){return typeof e=="function"}function u(t){return e.nativeType(t)=="object"}function a(e){return typeof e=="string"}function f(e){return"^"+t+"."+e}function l(n){var r=n[p],i=n.prototype[__type__];if(r in b)throw new Error(t+".register: Unable to register Class without "+p+" property.");i||e.def(n.prototype,__type__,i=r.toLowerCase().split(".").join("-"),"r",!0);if(r in S||i in x)throw new Error(t+".register: Unable to register Class. A Class called: "+r+", with type: "+i+" already exists.");return S[r]=x[i]=n}function c(e,t){return e[t]=!0,e}function h(e){var t=e.constructor,n=t[p]||t[d];return n in b?"Anonymous":n}var p="__classname__",d="__name__",v="__singleton__",m="__super__",__type__="__type__",g=t.toLowerCase(),y,b=Function.anon_list,w=e.obj(),E=/[^A-Za-z0-9_\.]/g,S=e.obj(),x=e.obj();e.def(n,"define",function(){function t(t,o){var a,f,l,c=r(o,s),h;return u(t)&&(o=t,t=o.classname||"",delete o.classname),h=t.replace(E,""),t=t.split("."),c.type||(c.type=h.toLowerCase().split(".").join("-")),f=n.Class(c),l=t.pop(),a=e.bless(t,o.module),i(c.singleton?f.constructor:f,h),a[l]=f}function i(t,n){return!n||e.def(t,p,n,"cw",!0),l(t)}var s="after before mixins module".split(" ").reduce(c,e.obj());return t}(),"w"),e.def(n,"Class",function(){function t(e){var t=x(e=T(e));return e.singleton?k(t,e.singleton):t}function n(){return f(this)||this.apply(Object.create(this.prototype),arguments)}function f(e){return e?e[v]||null:null}function l(t){return e.tostr(t[0])==="[object Arguments]"?t[0]:t}function h(t,n){var r=Object.getOwnPropertyDescriptor(t,n)||(o(t[n])?e.describe(t[n],"cw"):M);return r.writable=!0,r}function g(e,t,n){return n&&t===y?e:t}function w(t,n){return e.def(t,"parent",n,!0),t}function E(t,n){var r;switch(e.nativeType(n)){case"object":r=n;break;case"function":r=e.describe(N(n,h(this,t),t),"cw");break;default:r=e.describe(n,"ew")}return e.def(this,t,r,!0),this.constructor}function S(t){return e.def(t,__type__,O,!0),e.defs(t,{add:E.bind(t.prototype),create:n.bind(t)},"r",!0),t}function x(t){function r(){return s(this,r)?f(this.constructor)||g(this,v.call(this,arguments),!0):n.apply(r,arguments)}var i=t.constructor,o=t.extend,u=t.chain===!1||o.prototype[L]===!1?_:D,a=h(o.prototype,"constructor"),l=i[d],c=r.prototype=C(t),v=N(i,a);return c.constructor=r,c.parent=M.value,e.def(r,m,a,!0).def(c,L,u,!0),e.got(b,l)||e.def(r,p,l,"cw").def(r,"displayName",l,"cw"),S(r.mimic(i))}function T(t){var n=e.merge(e.obj(),t),r=n.constructor,s,u=n.extend;return!a(u)||(u=i(u)),o(u)||(u=Object),o(r)&&r!==Object||(r=u.valueOf()),a(n.type)||r===Object||e.got(b,s=String(r[d]))||(n.type=s.toLowerCase()),n.constructor=r,n.extend=u,n}function N(e,t,n){return t=!u(t)||e.valueOf()===t.value.valueOf()?M:t||M,function(){var r=h(this,"parent");return g(w(this,t),e.apply(this,l(arguments)),w(this,r)[L]!==!1)}.mimic(e,n)}function C(t){var n=r(t,A),i=t.extend,s=e.obj(),u=Object.reduce(n,function(e,t,n){return s[n]=!0,E.call(e,n,t),e},Object.create(i.prototype));return Object.getOwnPropertyNames(u).forEach(function(t){t in s||!o(this[t])||E.call(this,t,e.describe(N(this[t],M),"cw"))},u),e.def(u,__type__,t.type,"w",!0),e.defs(u,{mixins:{value:e.obj()},parent:M},"w",!0),u}function k(t,n){var r=t.create.apply(null,n===!0?[]:[].concat(n));return e.def(t,v,e.describe({value:r},"r")),r}var L="__chain__",A="chain constructor extend singleton type".split(" ").reduce(c,e.obj()),O=e.describe("class","r"),M=e.describe(N(e.noop,e.describe(e.noop,"cw"),"parent"),"cw"),_=e.describe(!1,"w"),D=e.describe(!0,"w");return t}(),"w"),n.define(f("Callback"),function(){function r(){return u in this?this:(this[u]=setTimeout(i.bind(this),this.buffer),this.exec.apply(this,arguments))}function i(){clearTimeout(this[u]),delete this[u]}function s(e){return e.indexOf("event")+5===e.length}function o(){return this.fire.apply(this,arguments)}var u="bufferId",a="timeoutId";return{constructor:function(n,i){e.copy(this,i||{});var s=e.describe(null,"w"),o=(e.type(this.buffer)=="number"?r:this.exec).bind(this);s.value=n,e.def(this,"fn",s),s.value=this,e.def(o,"cb",s),s.value=o,e.def(this,"fire",s),this.args||(this.args=[]),this.ctx||(this.ctx=this),e.type(this.delay)=="number"||(this.delay=null),e.type(this.times)=="number"&&this.times>0||(this.times=0),this.enable()},chain:!0,module:n,buffer:null,count:0,delay:null,times:0,disable:function(){this.disabled=!0,this.handleEvent=e.noop},enable:function(){this.disabled=!1,this.handleEvent=o},exec:function(){if(this.disabled)return;this.times===0||this.times>++this.count||this.disable();var n=Array.coerce(arguments),r=this,i=r.ctx,o=r.delay,u=e.type(n[0]),f;return u&&(s(u)||u==t+"-observer")?n.splice.apply(n,[1,0].concat(r.args)):n.unshift.apply(n,r.args),o===null?f=r.fn.apply(i,n):r[a]=setTimeout(function(){r.fn.apply(i,n)},o),f},reset:function(){this.count=0,i.call(this.enable())},stop:function(){!(a in this)||clearTimeout(this[a]),delete this[a]}}}()),n.define(f("Hash"),function(){var t="__hashid__",r=[];return{constructor:function(i){e.def(this,t,e.describe(r.push(e.obj())-1,"w")),!u(i)||this.set(i)},module:n,keys:{get:function(){return Object.keys(r[this[t]])}},length:{get:function(){return this.keys.length}},values:{get:function(){return Object.values(r[this[t]])}},aggregate:function(e,n,i){var s=this,o=r[this[t]];return i||(i=s),Object.keys(o).reduce(function(e,t,r){return n.call(i,e,o[t],t,s,r)},e)},clear:function(){r[this[t]]=e.obj()},clone:function(){return new n.Hash(this.valueOf())},each:function(e,n){var i=this,s=r[i[t]];n||(n=i),Object.keys(s).forEach(function(t,r){e.call(n,s[t],t,i,r)},i)},get:function(n){return e.has(r[this[t]],n)?r[this[t]][n]:null},has:function(n){return e.has(r[this[t]],n)},key:function(e){return Object.key(r[this[t]],e)},reduce:function(e,n){var i=this,s=r[i[t]];return Object.keys(s).reduce(function(t,n,r){return e.call(i,t,s[n],n,i,r)},n)},remove:function(n){return e.has(r[this[t]],n)?delete r[this[t]][n]:!1},set:function(n,i){switch(e.nativeType(n)){case"object":Object.keys(n).forEach(function(e){this.set(e,n[e])},this);break;default:r[this[t]][n]=i}},stringify:function(){return JSON.stringify(r[this[t]])},toString:function(){return e.tostr(r[this[t]])},valueOf:function(){return e.copy(e.obj(),r[this[t]])}}}()),n.define(f("Observer"),function(){function r(t){t=e.copy(e.obj(),t);var n=t.ctx,r,i,s,o=t.options,u;e.remove(t,"ctx","options");for(r in t){i=t[r],s=i.options===y?i.options:o,u=i.ctx===y?i.ctx:n;switch(e.nativeType(i)){case"function":this.observe(r,i,n,o);break;case"object":switch(e.nativeType(i.fn)){case"function":case"object":this.observe(r,i.fn,u,s);break;case"array":i.fn.forEach(function(e){this.observe(r,e,u,s)},this)}break;case"array":i.forEach(function(e){this.observe(r,e,n,o)},this)}}return this}function i(e){var t=this.args.concat(e.options.args),n=e.ctx||this.ctx,r=e.fire||e.fn;return o(r)?(Object.key(this.ctx,e.fn)?t[0]!==this.ctx||t.shift():t[0]!==this.ctx&&t.unshift(this.ctx),r.apply(n,t)!==!1):!0}function s(e,t,n){return function(){var i=Array.coerce(arguments);return i[0]!==e||i.shift(),i.unshift(n,t),d.apply(t,i)}}function a(e,t){var n=this;return t.fire=function(){n.ignore(e,t.fn,t.ctx);if(t.fired)return;return t.fired=!0,t.fn.apply(t.ctx||n,arguments)}}function f(e,t){var n=-1,r=e.length;while(++n<r)if(p(t,e[n]))return e[n];return null}function l(e,t,n){var r;return n===this||Array.isArray(r=this.match(n))&&r[0]===this?e.concat(t):e}function c(e,t){return e.listeners.aggregate([],l,t)}function h(e){return function(){return e.handleEvent.apply(e,arguments)}.mimic(e.fire)}function p(e,t){return(e.isCB===!0?t.fn.valueOf()===e.ctx.fire:t.fn===e.fn)&&t.ctx===e.ctx&&t.event===e.event}function d(){return this.broadcast.apply(this,arguments)}function v(e){return e.replace(g,".*")}var m=0,g=/\*/g;return{constructor:function(t){this.broadcasting=!1,this.destroyed=!1,this.observer_suspended=!1,this.listeners=n("Hash"),!u(t)||this.observe(t),!u(this.observers)||this.observe(this.observers),delete this.observers},module:n,broadcast:function(e){if(this.destroyed||this.observer_suspended||!this.listeners.length||!e)return;var t=Array.coerce(arguments,1),n=c(this,e);if(!n.length)return;this.broadcasting=e,n.every(i,{args:t,ctx:this}),this.broadcasting=!1},buffer:function(t,n,r,i,s){u(s)||(s=e.obj()),s.buffer=Number(t),this.observe(n,r,i,s)},delay:function(t,n,r,i,s){u(s)||(s=e.obj()),s.delay=Number(t),this.observe(n,r,i,s)},destroy:function(){return this.destroyed?!0:this.broadcast("before:destroy")===!1?!1:(this.destroyed=!0,this._destroy(),this.broadcast("destroy"),this.observer_suspended=!0,delete this.listeners,!0)},ignore:function(n,r,i){n=v(n.toLowerCase());var s=this.listeners.get(n),o,u;if(!s)return;switch(e.type(r)){case t+"-callback":u={ctx:r,isCB:!0};break;default:u={ctx:i||this,fn:r}}u.event=n,u=f(s,u),u!==null&&(o=s.indexOf(u),o<0||s.splice(o,1))},observe:function(n,i,s,o){var f,l=this.listeners,c,p;if(u(n))return r.call(this,n);switch(c=e.type(i)){case"array":return f=e.obj(),f[n]={fn:i,options:o,ctx:s},r.call(this,f);case"object":case"nullobject":case t+"-callback":"handleEvent"in i&&(!u(s)||o!==y||(o=s),s=i,i=h(i));break;case"string":!s||(i=s[i])}n=v(n.toLowerCase()),(p=l.get(n))||l.set(n,p=[]);switch(e.nativeType(o)){case"boolean":o={single:!!o};break;case"number":o={delay:o};break;case"object":o=e.copy(e.obj(),o);break;default:o=e.obj()}Array.isArray(o.args)||(o.args=[]),f={ctx:s||this,event:n,fn:i,id:++m,options:o},f.fire=(o.single?a.call(this,n,f):f.fn).callback({args:o.args,buffer:o.buffer,ctx:f.ctx,delay:o.delay}),p.push(f)},once:function(t,n,r,i){u(i)||(i=e.obj()),i.single=!0,this.observe(t,n,r,i)},purgeObservers:function(e){var t=this.listeners;if(!e){t.clear();return}e=e.toLowerCase(),!t.has(e)||t.set(e,[])},relayEvents:function(e){var t=Array.coerce(arguments,1),n;while(n=t.shift())this.observe(n,s(this,e,n),e)},resumeEvents:function(){!this.observer_suspended||(this.observer_suspended=!1,this.broadcast("observer:resumed"))},suspendEvents:function(){this.observer_suspended||(this.observer_suspended=!0,this.broadcast("observer:suspended"))},_destroy:e.noop}}()),e.x.cache("Function",function(t){e.def(t.prototype,"callback",function(e){return(new n.Callback(this,e)).fire.mimic(this)},"w")}),e.defs(n=e.expose(n,t,e.ENV=="commonjs"?module:e.global),{get:i,is:s,type:h,register:l},"w",!0),e.expose(e,n),b.Class_constructor=!0,b.Class_instance_method=!0,e.x(Object,Array,Boolean,Function)}(typeof m8!="undefined"?m8:typeof require!="undefined"?require("m8"):null,"id8")